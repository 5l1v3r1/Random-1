function Get-LdapCurrentUser {
    [CmdletBinding()]
    Param(
        [Parameter(Position=0, Mandatory=$true)]
        [string]
        $Server,

        [Parameter(Position=1, Mandatory=$false)]
        [System.DirectoryServices.Protocols.AuthType]
        $AuthType = [System.DirectoryServices.Protocols.AuthType]::Kerberos,

        [Parameter(Position=2, Mandatory=$false)]
        [switch]
        $UseSSL = $false
    )

    $null = [System.Reflection.Assembly]::LoadWithPartialName("System.DirectoryServices.Protocols")
    $null = [System.Reflection.Assembly]::LoadWithPartialName("System.Net")

    $c = New-Object System.DirectoryServices.Protocols.LdapConnection $Server

    $c.SessionOptions.SecureSocketLayer = $UseSSL;
    $c.AuthType = $AuthType

    $c.Bind();

    $ExtRequest = New-Object System.DirectoryServices.Protocols.ExtendedRequest "1.3.6.1.4.1.4203.1.11.3"
    $resp = $c.SendRequest($ExtRequest)
    [System.Text.Encoding]::ascii.getstring($resp.ResponseValue)
}
